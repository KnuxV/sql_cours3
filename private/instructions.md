# [The Private Eye](https://cs50.harvard.edu/sql/2024/psets/4/private/)

![A detective's library in the style of an oil painting](https://cs50.harvard.edu/sql/2024/psets/4/private/library.png) “A detective’s library in the style of an oil painting,” generated by DALL·E 2

## Problème à résoudre

[Le débogueur de canard (duck debugger) de CS50](https://cs50.ai/) a encore disparu et vous avez désespérément besoin d'un détective. Vous avez entendu des histoires sur un détective qui vit en haut de la ville, toujours secret dans son travail, jamais vu sauf quand il le souhaite. Sans surprise, il s'est avéré être assez insaisissable pour vous. Mais vous voilà, dans son étude, après avoir récupéré son adresse auprès d'un certain employé de la poste.

Sur son bureau en acajou, du papier blanc frais scintille. Inscrit, vous trouvez le tableau suivant :


|      |      |      |
| ---- | ---- | ---- |
| 14   | 98   | 4    |
| 114  | 3    | 5    |
| 618  | 72   | 9    |
| 630  | 7    | 3    |
| 932  | 12   | 5    |
| 2230 | 50   | 7    |
| 2346 | 44   | 10   |
| 3041 | 14   | 5    |


Et glissé en dessous, un livre usé, Les Aventures de Sherlock Holmes.

## Code de distribution

Pour ce problème, vous devrez télécharger `private.db` et `private.sql`.

## Contexte

Étant donné la proximité du papier avec Les Aventures de Sherlock Holmes, ce qui est écrit sur celui-ci semble être une variation d'un chiffre de livre (book cipher). Vous savez que dans une version d'un chiffre de livre, le créateur du chiffre vous donne une liste de “triplets” (c'est-à-dire un ensemble de trois nombres). Chaque triplet est structuré comme suit :

- Le premier nombre du triplet est le numéro de la phrase référencée par l'encodeur.
- Le deuxième nombre du triplet est le numéro du caractère, dans cette phrase, où le message commence.
- Le troisième nombre du triplet est la longueur du message en caractères (c'est-à-dire combien de caractères lire à partir du premier, y compris les espaces et la ponctuation).

Par exemple, considérez le triplet 2, 1, 8 à la lumière des phrases suivantes :

> Quite so! You have not observed. And yet you have seen.

2 fait référence à la 2ème phrase, “You have not observed.” 1 fait référence au 1er caractère de cette phrase, “Y.” Et 8 fait référence à la longueur du message à partir de ce premier caractère. En commençant par le 1er caractère de la 2ème phrase, en lisant 8 caractères (y compris les espaces !) vous obtenez :

> You have

Vous pouvez imaginer, maintenant, enchaîner plusieurs tuples pour encoder un message plus long. Peut-être que c'est exactement ce que le détective a fait !

## Schéma

Dans `private.db`, vous trouverez une table, `sentences`. La table `sentences` contient toutes les phrases des Aventures de Sherlock Holmes. En particulier, elle contient les colonnes suivantes :

- `id`, qui est l'ID de la phrase
- `sentence`, qui est la phrase elle-même

## Spécification

Votre tâche est de décoder le chiffre laissé pour vous par le détective. La manière dont vous le faites dépend de vous, mais vous devez vous assurer que—à la fin de votre processus—vous avez une vue (view) structurée comme suit :

- La vue doit être nommée `message`
- La vue doit avoir une seule colonne, `phrase`
- Lorsque la requête SQL (SQL query) suivante est exécutée sur `private.db`, votre vue doit renvoyer une seule colonne dans laquelle chaque ligne est une phrase du message.

```
SELECT "phrase" FROM "message";
```

Dans `private.sql`, vous devez écrire toutes les instructions SQL (SQL statements) nécessaires pour reproduire votre création de la vue. C'est-à-dire :

- Si la création de la vue nécessite la création d'une table séparée et l'insertion de données dans celle-ci, vous devez vous assurer que `private.sql` contient les instructions pour créer cette table et insérer ces données. (N'ayez pas peur d'ajouter des tables et d'ajouter des données comme vous le souhaitez !)
- `private.sql`, lorsqu'il est exécuté sur une nouvelle instance de `private.db`, doit être capable de reconstruire entièrement votre vue.

## Conseil

Il s'avère que SQLite est équipé d'une fonction qui implémente exactement la fonctionnalité du chiffre de livre : `substr`. La fonction `substr` prend trois entrées (“arguments”) :

- Une chaîne (c'est-à-dire du texte) à partir de laquelle prendre une sous-chaîne (c'est-à-dire un sous-ensemble des caractères de la chaîne)
- Le caractère de début de la sous-chaîne, identifié par son numéro (le premier caractère est 1)
- La longueur de la sous-chaîne

Par exemple, supposons que vous ayez une table appelée `sentences` qui inclut ce qui suit :


| ID   | sentence               |
| ---- | ---------------------- |
| 1    | Quite so!              |
| 2    | You have not observed. |
| 3    | And yet you have seen. |


Si vous exécutez la requête SQL suivante…

```sqlite
SELECT substr("sentence", 1, 2)
FROM "sentences";
```

vous recevrez les résultats suivants :


| ID   | Substring (1, 2) |
| ---- | ---------------- |
| 1    | Qu               |
| 2    | Yo               |
| 3    | An               |

Gardez à l'esprit que les autres arguments de `substr` peuvent également être des colonnes entières !
